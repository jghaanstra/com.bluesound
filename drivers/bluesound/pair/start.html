<script type="text/javascript">

Homey.setTitle( __('pair.title') );

$(function() {
    $('#test-connection').click(function() {
        $('.bluesound-test').hide();
        $('.bluesound-ok').hide();
        $('.bluesound-error').hide();
        $('.bluesound-info').hide();

		var inputaddress = $('#address').val();
        var inputport = Number($('#port').val());
        var inputpolling = Number($('#polling').val());

        if( inputaddress != '' && inputpolling != '') {
            var device_data = {
                address  : inputaddress,
                port     : inputport
            };

            Homey.emit('testConnection', device_data, function(error, result) {
                if(error == 401) {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html( __('pair.unauthorized') );
                } else if(error == 408 || error == 504) {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html( __('pair.timeout') );
                } else if(error == 500) {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html( __('pair.servererror') );
                } else if(!error && !result) {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html( __('pair.unknownerror') );
                } else if (result) {
                    $('#mac').val(result.mac);
                    $('#name').val(""+ result.brand +" "+ result.model +"");
                    var bluesoundinfo = "<div class='info-row'><span class='info-label' data-i18n='pair.name'>Device:</span><span class='info-value'> "+ result.brand +" "+ result.model +"</span></div><div class='info-row'><span class='info-label' data-i18n='pair.mac'>MAC Address:</span><span class='info-value'> "+ result.mac +"</span></div>";
                    $('.bluesound-test').show();
                    $('.bluesound-info').show();
                    $('.bluesound-info').html(bluesoundinfo);
                    $('#connect').prop('disabled', false);
                } else {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html( __('pair.unknownerror') );
                }
            });

        } else {
            $('.bluesound-error').show();
            $('.bluesound-error-msg').html( __('pair.nosettings') );
        }

	});

	$('#connect').click(function() {
        var inputmac = $('#mac').val();
        var inputname = $('#name').val();
        var inputaddress = $('#address').val();
        var inputport = Number($('#port').val());
        var inputpolling = Number($('#polling').val());

        if (inputmac != '' && inputname != '' && inputaddress != '' && inputport != '' && inputpolling != '') {
            var device_data = {
                id : inputmac
            };

            var settings = {
                address : inputaddress,
                port    : inputport,
                polling : inputpolling
            };

            var store = {
                state   : 'stop',
                service : '',
                shuffle : 0,
                repeat  : 0,
                mutevol : 0,
                artist  : 'Not available',
                track   : 'Not available',
                album   : 'Not available'
            };

            Homey.addDevice({
                name	 : inputname,
                data 	 : device_data,
                settings : settings,
                store    : store
            }, function(error, result) {
                if (error) {
                    $('.bluesound-error').show();
                    $('.bluesound-error-msg').html(error.message || error.toString() );
                }
                $('.bluesound-test').hide();
                $('.bluesound-error').hide();
                $('.bluesound-ok').show();

                Homey.done();
            })

        } else {
            $('.bluesound-error').show();
            $('.bluesound-error-msg').html( __('pair.nosettings') );
        }

	});
})
</script>

<style type="text/css">
    .bluesound-pairing {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .bluesound-pairing .col1, .bluesound-pairing .col2 {
        width: 48%;
    }
    .bluesound-status, .bluesound-info {
		display: none;
	}
    .bluesound-info {
        margin-top: 10px;
        font-size: 12px;
    }
    .bluesound-info .info-label {
        min-width: 150px;
        font-weight: 700;
    }
	.bluesound-status {
		display: none;
	}
    .buttons, .messages {
        padding-top: 14px;
    }
    .bluesound-image {
        margin: 0 auto;
    }
    .bluesound-image img {
        width: 100%;
        height: auto;
        display: block;
    }
</style>

<p data-i18n="pair.intro">Enter the IP address and port of your Bluesound device.</p>
<div class="bluesound-pairing">
    <div class="col1">
        <div class="form-group">
            <label for="address" data-i18n="pair.address">IP address</label>
            <input type="text" class="form-control" id="address" placeholder="0.0.0.0" required>
        </div>
        <div class="form-group">
        	<label for="port" data-i18n="pair.port">Port</label>
        	<input type="number" class="form-control" id="port" placeholder="11000" value="11000" required>
        </div>
        <div class="form-group">
        	<label for="polling" data-i18n="pair.polling">Polling Frequency</label>
        	<input type="number" class="form-control" id="polling" min="4" max="3600" placeholder="4" value="4" required>
        </div>
        <input type="hidden" id="mac" value="">
        <input type="hidden" id="name" value="">
        <div class="form-group buttons">
            <button id="test-connection" class="button" data-i18n="pair.test">Test Connection</button>
            <button id="connect" class="button" data-i18n="pair.connect" disabled>Connect</button>
        </div>
    </div>
    <div class="col2">
        <div class="bluesound-image"><img src="data:image/png;base64,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" alt="Bluesound" border="0" /></div>
        <div class="bluesound-info"></div>
    </div>
</div>
<div class="messages">
    <p class="bluesound-status bluesound-test" style="color: #008C23;"><i class="fa fa-check"></i> <span class="bluesound-test-msg" data-i18n="pair.testing">Bluesound connection test succesfull, you can now connect the Bluesound device.</span></p>
    <p class="bluesound-status bluesound-ok" style="color: #008C23;"><i class="fa fa-check"></i> <span class="bluesound-ok-msg" data-i18n="pair.success">Bluesound device added succesfully.</span></p>
    <p class="bluesound-status bluesound-error" style="color: #ff6300;"><i class="fa fa-times"></i> <span class="bluesound-error-msg"></span></p>
</div>
